class FadeScene : AbstractScene {
	constructor(prev_scene, next_scene) : base() {
		this.counter = 0;
		this.prev_scene = prev_scene;
		this.next_scene = next_scene;
		this.bg = prev_scene;
		this.opacity = 0;
	}
	
	function update(events, pressed_keys) {
		this.counter++;
		if (this.counter >= FPS) {
			this.next = this.next_scene;
		}
		
		halfway = FPS / 2.0;
		
		if (this.counter < halfway) {
			this.bg = this.prev_scene;
			progress = this.counter / halfway;
		} else {
			progress = (this.counter - halfway) / halfway;
			progress = 1 - progress;
		}
		if (progress > 1) progress = 1.0;
		if (progress < 0) progress = 0.0;
		this.opacity = progress;
		
		this.bg = (this.counter < FPS / 2) ? this.prev_scene : this.next_scene;
	}
	
	function render(rc) {
		this.bg.render(rc);
		$gfx_draw_rectangle(0, 0, GAME_WIDTH, GAME_HEIGHT, 0, 0, 0, $floor(255 * this.opacity));
	}
}